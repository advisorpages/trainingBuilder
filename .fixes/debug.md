2025-10-08 17:41:08 error: [SessionsService] Variant 4 generation failed: OpenAI outline validation failed: Outline section durations do not align with totalDuration {"stack":[null]}
2025-10-08 17:41:10 error: [OpenAIService] OpenAI outline validation failed {"stack":[{"message":"Outline section durations do not align with totalDuration"}]}
2025-10-08 17:41:10 error: [OpenAIService] All 3 attempts failed: {"stack":[{"name":"OpenAIOutlineValidationError"}]}
2025-10-08 17:41:10 error: [OpenAIService] OpenAI API request failed: {"stack":[{"name":"OpenAIOutlineValidationError"}]}
query: START TRANSACTION
query: INSERT INTO "ai_interactions"("id", "created_at", "updated_at", "interaction_type", "status", "rendered_prompt", "input_variables", "ai_response", "structured_output", "error_message", "error_details", "processing_time_ms", "tokens_used", "estimated_cost", "model_used", "prompt_version", "user_feedback", "user_feedback_comment", "feedback_at", "quality_score", "edit_distance", "metadata", "audience_id", "tone_id", "category", "session_type", "all_variables_present", "missing_variables", "session_id", "user_id", "prompt_id") VALUES (DEFAULT, DEFAULT, DEFAULT, $1, $2, $3, $4, DEFAULT, DEFAULT, $5, $6, $7, DEFAULT, $8, $9, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT, $10, $11, $12, $13, $14, DEFAULT, DEFAULT, DEFAULT, DEFAULT) RETURNING "id", "created_at", "updated_at", "user_feedback", "all_variables_present" -- PARAMETERS: ["outline_generation","failure","# VARIANT PERSONALITY: Insight\n\nBuild a logic-driven 90-min session: Opening (10min), Theory (20-30min), Application (20-30min), Video, Closing+CTA. Emphasize facts, statistics, case studies, and measurable outcomes. Include data to support each point, specific metrics, and evidence-based practices. Design application exercises around analyzing real scenarios. Present knowledge base insights with proof points. Make it data-backed and intellectually rigorous.\n\nVariant Emphasis: Evidence-based approach with data, research, and proven strategies. Ideal for analytical thinkers.\n\n# Session Context\n- Category: Leadership\n- Type: workshop\n- Title: \"Effective Leadership Through Change\"\n- Duration: 180 minutes\n- Desired Outcome: Participants will be able to lead their teams through organizational change with confidence and clear communication strategies\n- Current Problem: Managers struggle to maintain team morale and productivity during periods of uncertainty and organizational transitions\n- Must Cover: Change management frameworks, transparent communication, building psychological safety, managing resistance\n- Audience Size: 8-20\n\n# Location Details\n- Name: Acadia Markham\n- Format: Physical\n- Capacity: 100 participants\n- Time Zone: America/Toronto\n- Special Considerations: asdasd\n\n# Audience Context\n- Profile: Prospects\n- **Key Guidance**: Use an encouraging, welcoming tone. Focus on the next step they can take to improve their finances. Present team opportunity as a path to accelerate financial and life goals. Avoid pressure - emphasize possibilities and empowerment. Use relatable success stories.\n- Description: Individuals exploring opportunities to improve their financial situation and learn about potential income opportunities\n- Experience Level: beginner\n- Technical Depth: 1/5\n- Communication Style: conversational\n- Vocabulary Level: basic\n- Learning Preferences: conversational, storytelling, relatable examples, encouraging atmosphere\n- Use Examples From: financial planning basics, debt reduction success stories, savings strategies, income opportunities, financial goal setting, life improvement through finances\n- **Avoid Topics**: overly technical financial jargon, high-pressure sales tactics, complex investment strategies\n\n# Tone Guidelines\n- Profile: Professional & Polished\n- **Key Guidance**: Maintain professional distance. Use industry-standard terminology. Support assertions with evidence. Avoid colloquialisms.\n- **Emotional Qualities**: confidence, authority, clarity\n- Description: Formal, authoritative tone suitable for executive audiences\n- Style: professional\n- Energy: moderate\n- Formality: 5/5\n- Sentence Structure: complex\n- Language Traits: active-voice, precise, data-driven, objective\n- Example Phrases:\n  \"Our analysis indicates that strategic alignment will drive measurable outcomes.\"\n  \"The data supports a phased implementation approach.\"\n  \"This framework has been validated across multiple industries.\"\n\n# Output Requirements\n- Return valid JSON with the specified structure\n- Ensure totalDuration equals 180 minutes exactly\n- Create 3-6 sections that flow logically\n- Include opening/welcome and closing/commitments sections\n- Make it practical, engaging, and immediately applicable\n\nNote: When audience and tone instructions conflict, prioritize audience needs.","{\"title\":\"Effective Leadership Through Change\",\"category\":\"Leadership\",\"sessionType\":\"workshop\",\"desiredOutcome\":\"Participants will be able to lead their teams through organizational change with confidence and clear communication strategies\",\"currentProblem\":\"Managers struggle to maintain team morale and productivity during periods of uncertainty and organizational transitions\",\"specificTopics\":\"Change management frameworks, transparent communication, building psychological safety, managing resistance\",\"duration\":180,\"audienceSize\":\"8-20\",\"audienceId\":1,\"toneId\":1,\"locationId\":1,\"locationName\":\"Acadia Markham\",\"locationType\":\"physical\",\"locationCapacity\":100,\"locationTimezone\":\"America/Toronto\",\"locationNotes\":\"asdasd\",\"ragWeight\":0,\"variantIndex\":1,\"variantLabel\":\"Insight\",\"variantInstruction\":\"Build a logic-driven 90-min session: Opening (10min), Theory (20-30min), Application (20-30min), Video, Closing+CTA. Emphasize facts, statistics, case studies, and measurable outcomes. Include data to support each point, specific metrics, and evidence-based practices. Design application exercises around analyzing real scenarios. Present knowledge base insights with proof points. Make it data-backed and intellectually rigorous.\",\"variantDescription\":\"Evidence-based approach with data, research, and proven strategies. Ideal for analytical thinkers.\",\"audienceName\":\"Prospects\",\"audienceDescription\":\"Individuals exploring opportunities to improve their financial situation and learn about potential income opportunities\",\"audienceExperienceLevel\":\"beginner\",\"audienceTechnicalDepth\":1,\"audienceCommunicationStyle\":\"conversational\",\"audienceVocabularyLevel\":\"basic\",\"audienceLearningStyle\":\"conversational, storytelling, relatable examples, encouraging atmosphere\",\"audienceExampleTypes\":[\"financial planning basics\",\"debt reduction success stories\",\"savings strategies\",\"income opportunities\",\"financial goal setting\",\"life improvement through finances\"],\"audienceAvoidTopics\":[\"overly technical financial jargon\",\"high-pressure sales tactics\",\"complex investment strategies\"],\"audienceInstructions\":\"Use an encouraging, welcoming tone. Focus on the next step they can take to improve their finances. Present team opportunity as a path to accelerate financial and life goals. Avoid pressure - emphasize possibilities and empowerment. Use relatable success stories.\",\"toneName\":\"Professional & Polished\",\"toneDescription\":\"Formal, authoritative tone suitable for executive audiences\",\"toneStyle\":\"professional\",\"toneFormality\":5,\"toneEnergyLevel\":\"moderate\",\"toneSentenceStructure\":\"complex\",\"toneLanguageCharacteristics\":[\"active-voice\",\"precise\",\"data-driven\",\"objective\"],\"toneEmotionalResonance\":[\"confidence\",\"authority\",\"clarity\"],\"toneExamplePhrases\":[\"Our analysis indicates that strategic alignment will drive measurable outcomes.\",\"The data supports a phased implementation approach.\",\"This framework has been validated across multiple industries.\"],\"toneInstructions\":\"Maintain professional distance. Use industry-standard terminology. Support assertions with evidence. Avoid colloquialisms.\"}","OpenAI outline validation failed: Outline section durations do not align with totalDuration","{\"stack\":\"OpenAIOutlineValidationError: OpenAI outline validation failed: Outline section durations do not align with totalDuration\\n    at OpenAIService.generateSessionOutline (/Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/packages/backend/dist/services/openai.service.js:152:50)\\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at async SessionsService.generateSingleVariant (/Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/packages/backend/dist/modules/sessions/sessions.service.js:1412:27)\\n    at async Promise.all (index 1)\\n    at async SessionsService.suggestMultipleOutlines (/Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/packages/backend/dist/modules/sessions/sessions.service.js:1288:32)\\n    at async /Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/node_modules/@nestjs/core/router/router-execution-context.js:46:28\\n    at async /Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/node_modules/@nestjs/core/router/router-proxy.js:9:17\",\"name\":\"OpenAIOutlineValidationError\"}",55208,0,"gpt-4o-mini",1,1,"Leadership","workshop",true]
query: COMMIT
2025-10-08 17:41:10 error: [SessionsService] Variant 2 generation failed: OpenAI outline validation failed: Outline section durations do not align with totalDuration {"stack":[null]}
2025-10-08 17:41:15 error: [OpenAIService] OpenAI outline validation failed {"stack":[{"message":"Outline section durations do not align with totalDuration"}]}
2025-10-08 17:41:15 error: [OpenAIService] All 3 attempts failed: {"stack":[{"name":"OpenAIOutlineValidationError"}]}
2025-10-08 17:41:15 error: [OpenAIService] OpenAI API request failed: {"stack":[{"name":"OpenAIOutlineValidationError"}]}
query: START TRANSACTION
query: INSERT INTO "ai_interactions"("id", "created_at", "updated_at", "interaction_type", "status", "rendered_prompt", "input_variables", "ai_response", "structured_output", "error_message", "error_details", "processing_time_ms", "tokens_used", "estimated_cost", "model_used", "prompt_version", "user_feedback", "user_feedback_comment", "feedback_at", "quality_score", "edit_distance", "metadata", "audience_id", "tone_id", "category", "session_type", "all_variables_present", "missing_variables", "session_id", "user_id", "prompt_id") VALUES (DEFAULT, DEFAULT, DEFAULT, $1, $2, $3, $4, DEFAULT, DEFAULT, $5, $6, $7, DEFAULT, $8, $9, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT, DEFAULT, $10, $11, $12, $13, $14, DEFAULT, DEFAULT, DEFAULT, DEFAULT) RETURNING "id", "created_at", "updated_at", "user_feedback", "all_variables_present" -- PARAMETERS: ["outline_generation","failure","# VARIANT PERSONALITY: Precision\n\nCreate a highly organized 90-min session: Opening (10min), Theory (20-30min), Application (20-30min), Video, Closing+CTA. Use sequential steps, detailed agendas, and clear time blocks. Include specific talking points, checklists, and exact activities for trainers to follow verbatim. Every section needs explicit objectives. Present knowledge base insights systematically. Make it predictable and orderly for less experienced trainers.\n\nVariant Emphasis: Clear, step-by-step approach with predictable flow and detailed guidance. Ideal for structured learning.\n\n# Session Context\n- Category: Leadership\n- Type: workshop\n- Title: \"Effective Leadership Through Change\"\n- Duration: 180 minutes\n- Desired Outcome: Participants will be able to lead their teams through organizational change with confidence and clear communication strategies\n- Current Problem: Managers struggle to maintain team morale and productivity during periods of uncertainty and organizational transitions\n- Must Cover: Change management frameworks, transparent communication, building psychological safety, managing resistance\n- Audience Size: 8-20\n\n# Location Details\n- Name: Acadia Markham\n- Format: Physical\n- Capacity: 100 participants\n- Time Zone: America/Toronto\n- Special Considerations: asdasd\n\n# Audience Context\n- Profile: Prospects\n- **Key Guidance**: Use an encouraging, welcoming tone. Focus on the next step they can take to improve their finances. Present team opportunity as a path to accelerate financial and life goals. Avoid pressure - emphasize possibilities and empowerment. Use relatable success stories.\n- Description: Individuals exploring opportunities to improve their financial situation and learn about potential income opportunities\n- Experience Level: beginner\n- Technical Depth: 1/5\n- Communication Style: conversational\n- Vocabulary Level: basic\n- Learning Preferences: conversational, storytelling, relatable examples, encouraging atmosphere\n- Use Examples From: financial planning basics, debt reduction success stories, savings strategies, income opportunities, financial goal setting, life improvement through finances\n- **Avoid Topics**: overly technical financial jargon, high-pressure sales tactics, complex investment strategies\n\n# Tone Guidelines\n- Profile: Professional & Polished\n- **Key Guidance**: Maintain professional distance. Use industry-standard terminology. Support assertions with evidence. Avoid colloquialisms.\n- **Emotional Qualities**: confidence, authority, clarity\n- Description: Formal, authoritative tone suitable for executive audiences\n- Style: professional\n- Energy: moderate\n- Formality: 5/5\n- Sentence Structure: complex\n- Language Traits: active-voice, precise, data-driven, objective\n- Example Phrases:\n  \"Our analysis indicates that strategic alignment will drive measurable outcomes.\"\n  \"The data supports a phased implementation approach.\"\n  \"This framework has been validated across multiple industries.\"\n\n# Output Requirements\n- Return valid JSON with the specified structure\n- Ensure totalDuration equals 180 minutes exactly\n- Create 3-6 sections that flow logically\n- Include opening/welcome and closing/commitments sections\n- Make it practical, engaging, and immediately applicable\n\nNote: When audience and tone instructions conflict, prioritize audience needs.","{\"title\":\"Effective Leadership Through Change\",\"category\":\"Leadership\",\"sessionType\":\"workshop\",\"desiredOutcome\":\"Participants will be able to lead their teams through organizational change with confidence and clear communication strategies\",\"currentProblem\":\"Managers struggle to maintain team morale and productivity during periods of uncertainty and organizational transitions\",\"specificTopics\":\"Change management frameworks, transparent communication, building psychological safety, managing resistance\",\"duration\":180,\"audienceSize\":\"8-20\",\"audienceId\":1,\"toneId\":1,\"locationId\":1,\"locationName\":\"Acadia Markham\",\"locationType\":\"physical\",\"locationCapacity\":100,\"locationTimezone\":\"America/Toronto\",\"locationNotes\":\"asdasd\",\"ragWeight\":0,\"variantIndex\":0,\"variantLabel\":\"Precision\",\"variantInstruction\":\"Create a highly organized 90-min session: Opening (10min), Theory (20-30min), Application (20-30min), Video, Closing+CTA. Use sequential steps, detailed agendas, and clear time blocks. Include specific talking points, checklists, and exact activities for trainers to follow verbatim. Every section needs explicit objectives. Present knowledge base insights systematically. Make it predictable and orderly for less experienced trainers.\",\"variantDescription\":\"Clear, step-by-step approach with predictable flow and detailed guidance. Ideal for structured learning.\",\"audienceName\":\"Prospects\",\"audienceDescription\":\"Individuals exploring opportunities to improve their financial situation and learn about potential income opportunities\",\"audienceExperienceLevel\":\"beginner\",\"audienceTechnicalDepth\":1,\"audienceCommunicationStyle\":\"conversational\",\"audienceVocabularyLevel\":\"basic\",\"audienceLearningStyle\":\"conversational, storytelling, relatable examples, encouraging atmosphere\",\"audienceExampleTypes\":[\"financial planning basics\",\"debt reduction success stories\",\"savings strategies\",\"income opportunities\",\"financial goal setting\",\"life improvement through finances\"],\"audienceAvoidTopics\":[\"overly technical financial jargon\",\"high-pressure sales tactics\",\"complex investment strategies\"],\"audienceInstructions\":\"Use an encouraging, welcoming tone. Focus on the next step they can take to improve their finances. Present team opportunity as a path to accelerate financial and life goals. Avoid pressure - emphasize possibilities and empowerment. Use relatable success stories.\",\"toneName\":\"Professional & Polished\",\"toneDescription\":\"Formal, authoritative tone suitable for executive audiences\",\"toneStyle\":\"professional\",\"toneFormality\":5,\"toneEnergyLevel\":\"moderate\",\"toneSentenceStructure\":\"complex\",\"toneLanguageCharacteristics\":[\"active-voice\",\"precise\",\"data-driven\",\"objective\"],\"toneEmotionalResonance\":[\"confidence\",\"authority\",\"clarity\"],\"toneExamplePhrases\":[\"Our analysis indicates that strategic alignment will drive measurable outcomes.\",\"The data supports a phased implementation approach.\",\"This framework has been validated across multiple industries.\"],\"toneInstructions\":\"Maintain professional distance. Use industry-standard terminology. Support assertions with evidence. Avoid colloquialisms.\"}","OpenAI outline validation failed: Outline section durations do not align with totalDuration","{\"stack\":\"OpenAIOutlineValidationError: OpenAI outline validation failed: Outline section durations do not align with totalDuration\\n    at OpenAIService.generateSessionOutline (/Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/packages/backend/dist/services/openai.service.js:152:50)\\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\\n    at async SessionsService.generateSingleVariant (/Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/packages/backend/dist/modules/sessions/sessions.service.js:1412:27)\\n    at async Promise.all (index 0)\\n    at async SessionsService.suggestMultipleOutlines (/Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/packages/backend/dist/modules/sessions/sessions.service.js:1288:32)\\n    at async /Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/node_modules/@nestjs/core/router/router-execution-context.js:46:28\\n    at async /Users/anthony-macbook/Documents/_DEV/TrainingBuilderv4/node_modules/@nestjs/core/router/router-proxy.js:9:17\",\"name\":\"OpenAIOutlineValidationError\"}",60234,0,"gpt-4o-mini",1,1,"Leadership","workshop",true]
query: COMMIT
2025-10-08 17:41:15 error: [SessionsService] Variant 1 generation failed: OpenAI outline validation failed: Outline section durations do not align with totalDuration {"stack":[null]}
2025-10-08 17:41:15 warn: [[object Object]] All variant generation attempts failed, falling back to legacy outline
query: SELECT "Audience"."id" AS "Audience_id", "Audience"."name" AS "Audience_name", "Audience"."description" AS "Audience_description", "Audience"."experience_level" AS "Audience_experience_level", "Audience"."technical_depth" AS "Audience_technical_depth", "Audience"."preferred_learning_style" AS "Audience_preferred_learning_style", "Audience"."communication_style" AS "Audience_communication_style", "Audience"."example_types" AS "Audience_example_types", "Audience"."avoid_topics" AS "Audience_avoid_topics", "Audience"."vocabulary_level" AS "Audience_vocabulary_level", "Audience"."prompt_instructions" AS "Audience_prompt_instructions", "Audience"."is_active" AS "Audience_is_active", "Audience"."created_at" AS "Audience_created_at", "Audience"."updated_at" AS "Audience_updated_at" FROM "audiences" "Audience" WHERE (("Audience"."id" = $1)) LIMIT 1 -- PARAMETERS: [1]
query: SELECT "Tone"."id" AS "Tone_id", "Tone"."name" AS "Tone_name", "Tone"."description" AS "Tone_description", "Tone"."style" AS "Tone_style", "Tone"."formality" AS "Tone_formality", "Tone"."energy_level" AS "Tone_energy_level", "Tone"."language_characteristics" AS "Tone_language_characteristics", "Tone"."sentence_structure" AS "Tone_sentence_structure", "Tone"."emotional_resonance" AS "Tone_emotional_resonance", "Tone"."example_phrases" AS "Tone_example_phrases", "Tone"."prompt_instructions" AS "Tone_prompt_instructions", "Tone"."is_active" AS "Tone_is_active", "Tone"."created_at" AS "Tone_created_at", "Tone"."updated_at" AS "Tone_updated_at" FROM "tones" "Tone" WHERE (("Tone"."id" = $1)) LIMIT 1 -- PARAMETERS: [1]
query: SELECT "Location"."id" AS "Location_id", "Location"."name" AS "Location_name", "Location"."description" AS "Location_description", "Location"."location_type" AS "Location_location_type", "Location"."address" AS "Location_address", "Location"."city" AS "Location_city", "Location"."state" AS "Location_state", "Location"."country" AS "Location_country", "Location"."postal_code" AS "Location_postal_code", "Location"."capacity" AS "Location_capacity", "Location"."meeting_platform" AS "Location_meeting_platform", "Location"."meeting_link" AS "Location_meeting_link", "Location"."meeting_id" AS "Location_meeting_id", "Location"."meeting_password" AS "Location_meeting_password", "Location"."dial_in_number" AS "Location_dial_in_number", "Location"."timezone" AS "Location_timezone", "Location"."access_instructions" AS "Location_access_instructions", "Location"."notes" AS "Location_notes", "Location"."is_active" AS "Location_is_active", "Location"."created_at" AS "Location_created_at", "Location"."updated_at" AS "Location_updated_at" FROM "locations" "Location" WHERE (("Location"."id" = $1)) LIMIT 1 -- PARAMETERS: [1]
2025-10-08 17:41:15 info: [SessionsService] Attempting OpenAI generation for session: Effective Leadership Through Change
2025-10-08 17:41:15 info: [OpenAIService] Generating session outline for: Effective Leadership Through Change
2025-10-08 17:41:16 error: [OpenAIService] OpenAI outline validation failed {"stack":[{"message":"Outline section durations do not align with totalDuration"}]}
2025-10-08 17:41:16 warn: [OpenAIOutlineValidationError: OpenAI outline validation failed: Outline section durations do not align with totalDuration] Attempt 1 failed, retrying...