# Story 2.5: Iterative Content Regeneration

## Status
Ready for Review

## Story
**As a** Content Developer,
**I want** to regenerate and refine AI-generated content until I'm satisfied with the results,
**so that** I can achieve the perfect promotional copy for my training session.

## Story Context

**Existing System Integration:**

- Integrates with: AI copy generation (Story 2.4), prompt review system (Story 2.3), content display interface
- Technology: React frontend with state management, NestJS backend, AI service with regeneration capabilities
- Follows pattern: Iterative workflow patterns with user feedback loops
- Touch points: Generated content storage, AI service, content versioning, user preference tracking

## Acceptance Criteria

**Functional Requirements:**

1. Content Developer can regenerate any individual content type without affecting others
2. Content Developer can regenerate all content with modified prompt or parameters
3. System preserves previous content versions for comparison and rollback
4. Content Developer can provide feedback or direction for regeneration (tone adjustments, focus changes)
5. System tracks regeneration attempts and learns from user preferences
6. Content Developer can mix and match content from different generation attempts

**Integration Requirements:**

7. Regeneration workflow integrates seamlessly with content display from Story 2.4
8. Regeneration maintains session context and prompt relationships
9. Integration with existing AI service handles multiple generation requests efficiently

**Quality Requirements:**

10. Regeneration is fast and provides clear feedback on progress and options
11. Content version management is intuitive and doesn't overwhelm the user
12. Interface follows existing admin design patterns for workflow management

## Technical Notes

- **Integration Approach:** Extend content generation service with regeneration capabilities and version management
- **Existing Pattern Reference:** Follow iterative workflow patterns from existing admin interfaces
- **Key Constraints:** Must handle multiple content versions efficiently; AI service rate limiting considerations

## Definition of Done

- [x] Individual content type regeneration implemented
- [x] Full content regeneration with parameter modifications working
- [x] Content version management and comparison interface complete
- [x] User feedback integration for regeneration direction
- [x] Content mixing and matching functionality implemented
- [x] Performance optimizations for multiple AI service calls

## Tasks / Subtasks

- [x] Task 1: Content Regeneration Service (AC: 1, 2, 5)
  - [x] Extend AI service to handle selective content regeneration
  - [x] Implement regeneration with user feedback and parameter modifications
  - [x] Add regeneration tracking and user preference learning
  - [x] Optimize AI service calls for multiple regeneration requests
  - [x] Handle regeneration queue and rate limiting

- [x] Task 2: Content Version Management (AC: 3, 6)
  - [x] Implement content versioning system for tracking multiple generations
  - [x] Create content version storage and retrieval
  - [x] Add content comparison interface for side-by-side viewing
  - [x] Implement content selection and mixing from different versions
  - [x] Add version metadata (generation parameters, timestamps, feedback)

- [x] Task 3: Regeneration Interface (AC: 1, 2, 4, 12)
  - [x] Add regeneration controls to content display interface
  - [x] Implement individual content type regeneration buttons
  - [x] Create regeneration parameter adjustment interface
  - [x] Add feedback input fields for regeneration direction
  - [x] Follow existing admin interface patterns for workflow controls

- [x] Task 4: Content Comparison & Selection (AC: 3, 6, 11)
  - [x] Create content version comparison view
  - [x] Implement content selection interface (radio buttons, checkboxes)
  - [x] Add preview of final content combination
  - [x] Create intuitive version navigation and management
  - [x] Handle content rollback to previous versions

- [x] Task 5: Workflow Integration & Performance (AC: 7-10)
  - [x] Integrate regeneration workflow with existing content display
  - [x] Optimize performance for multiple regeneration attempts
  - [x] Maintain session and prompt context during regeneration cycles
  - [x] Add progress indicators for regeneration processes
  - [x] Test complete regeneration workflow under various scenarios

## Dev Notes

### Content Versioning Strategy
[Source: Story 2.4 content generation and user workflow needs]

**Version Management Requirements:**
- Track multiple versions of each content type separately
- Preserve generation parameters and prompts for each version
- Enable rollback to any previous version
- Support partial content selection (headline from version 1, description from version 3)
- Maintain audit trail of user preferences and feedback

**Storage Considerations:**
- Efficient storage of multiple content versions
- Quick retrieval for comparison interfaces
- Cleanup of old versions to prevent storage bloat
- Metadata tracking for each version (quality scores, user ratings)

### Regeneration Strategies
[Source: AI service integration and user experience needs]

**Regeneration Types:**
1. **Individual Content Type:** Regenerate just headlines, just descriptions, etc.
2. **Prompt Modification:** Change prompt parameters and regenerate all content
3. **Feedback-Driven:** Use user feedback to guide regeneration direction
4. **Parameter Tweaking:** Adjust tone, length, focus without changing core prompt

**AI Service Optimization:**
- Batch regeneration requests when possible
- Cache successful generations to avoid redundant calls
- Implement smart regeneration that focuses on user-indicated problem areas
- Rate limiting management for multiple successive regenerations

### User Experience Design
[Source: Story 2.4 content display patterns]

**Interface Requirements:**
- Clear regeneration controls next to each content type
- Version comparison with easy navigation
- Content selection interface (mix and match)
- Progress indicators during regeneration
- Clear indication of current vs. previous versions
- Undo/redo functionality for content selection

**Workflow Integration:**
- Seamless transition from initial generation (Story 2.4) to regeneration
- Maintain context with prompt review (Story 2.3) for parameter changes
- Prepare for final content saving (Story 2.6) with selected content

### Success Criteria
The story is successful when Content Developers can iteratively refine their AI-generated content through multiple regeneration cycles until they achieve the desired quality and tone for their promotional materials.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-16 | 1.0 | Initial story creation for iterative content regeneration | BMad Master |
| 2025-09-16 | 1.1 | Story implementation completed - Full iterative content regeneration system functional | James Dev Agent |

## Dev Agent Record

### Agent Model Used
James Dev Agent powered by Sonnet 4 (claude-sonnet-4-20250514)

### Completion Notes List
- **Complete iterative regeneration system** - Extended AI service with selective content type regeneration and user feedback integration
- **Content versioning and comparison** - Full version management system with comparison interface and restoration capabilities
- **Smart regeneration interface** - Modal with user feedback, tone adjustment, length control, and focus parameters
- **Version history management** - Comprehensive comparison view with side-by-side content analysis and version restoration
- **Seamless workflow integration** - Integrated with existing Story 2.4 content display with new "Smart Regenerate" and "Version History" buttons
- **Performance optimization** - Efficient content merging, version storage limits, and regeneration progress tracking
- **Enhanced user experience** - Intuitive controls for selective regeneration with real-time feedback and error handling

### File List
- packages/backend/src/modules/ai/ai.service.ts (extended with regenerateContent method and version management)
- packages/backend/src/modules/ai/ai.controller.ts (added /regenerate-content endpoint)
- packages/backend/src/modules/sessions/sessions.service.ts (enhanced with content versioning system)
- packages/backend/src/modules/sessions/sessions.controller.ts (added version management endpoints)
- packages/frontend/src/services/ai-content.service.ts (added regeneration and version management methods)
- packages/frontend/src/components/sessions/AIContentDisplay.tsx (enhanced with regeneration modal and version access)
- packages/frontend/src/components/sessions/AIPromptGenerator.tsx (integrated regeneration and version restoration)
- packages/frontend/src/components/sessions/ContentVersionComparison.tsx (new comprehensive version comparison interface)

## QA Results
*To be populated by QA agent*