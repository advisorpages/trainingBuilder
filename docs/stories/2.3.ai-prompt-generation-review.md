# Story 2.3: AI Prompt Generation and Review

## Status
Ready for Review

## Story
**As a** Content Developer,
**I want** the system to generate AI prompts based on my session details and review them before content generation,
**so that** I can ensure the AI will create appropriate promotional copy for my training session.

## Story Context

**Existing System Integration:**

- Integrates with: Session worksheet UI (Story 2.1), session draft system (Story 2.2), session entity data
- Technology: React frontend, NestJS backend with AI integration, OpenAI/LLM API
- Follows pattern: API integration patterns from existing backend services
- Touch points: Session data, AI service integration, prompt template system

## Acceptance Criteria

**Functional Requirements:**

1. System generates structured AI prompt based on complete session worksheet data
2. Content Developer can review generated prompt before proceeding to content generation
3. Content Developer can edit and customize the generated prompt
4. Prompt generation incorporates session details (topic, audience, tone, trainer info, location)
5. System provides preview of what type of content will be generated from the prompt
6. Content Developer can regenerate prompt with different parameters or approaches

**Integration Requirements:**

7. Prompt generation integrates seamlessly with session worksheet workflow (after draft save)
8. Generated prompts follow consistent template structure for reliable AI output
9. Integration with existing session data maintains all relationship integrity

**Quality Requirements:**

10. Prompt generation is fast and provides clear loading indicators
11. Generated prompts are high-quality and relevant to session details
12. Interface follows existing admin design patterns and user experience

## Technical Notes

- **Integration Approach:** Add AI prompt generation step to session workflow after worksheet completion
- **Existing Pattern Reference:** Follow API integration patterns from existing backend services
- **Key Constraints:** Requires AI service integration; prompt quality critical for downstream content generation

## Definition of Done

- [ ] AI prompt generation service implemented and integrated
- [ ] Prompt review interface allows editing and customization
- [ ] Prompt generation incorporates all relevant session data
- [ ] Prompt regeneration functionality working
- [ ] Integration with session workflow complete
- [ ] Error handling for AI service failures implemented

## Tasks / Subtasks

- [x] Task 1: AI Service Integration (AC: 1, 4, 11)
  - [x] Set up AI service integration (Backend AI service created)
  - [x] Create prompt generation service in backend
  - [x] Implement prompt template system for consistent structure
  - [x] Add session data to prompt context (topic, audience, tone, etc.)
  - [x] Handle AI service authentication and rate limiting

- [x] Task 2: Prompt Generation Logic (AC: 4, 5, 8)
  - [x] Design prompt template structure for training session content
  - [x] Implement dynamic prompt building from session attributes
  - [x] Add context about trainer background and location details
  - [x] Create prompt variations for different content types
  - [x] Add preview generation showing expected output types

- [x] Task 3: Frontend Prompt Review Interface (AC: 2, 3, 6, 12)
  - [x] Create prompt review page/modal in session workflow
  - [x] Add prompt editing interface with syntax highlighting or formatting
  - [x] Implement prompt regeneration with parameter adjustments
  - [x] Add preview of content types that will be generated
  - [x] Follow existing admin interface design patterns

- [x] Task 4: Workflow Integration (AC: 7, 9)
  - [x] Integrate prompt generation step after session draft completion
  - [x] Add navigation between worksheet, draft save, and prompt review
  - [x] Maintain session state throughout prompt generation workflow
  - [x] Handle workflow interruption and resumption gracefully

- [x] Task 5: Error Handling & User Experience (AC: 10, 12)
  - [x] Implement robust error handling for AI service failures
  - [x] Add loading states and progress indicators for prompt generation
  - [x] Provide fallback options when AI service is unavailable
  - [x] Add user feedback for prompt quality and satisfaction
  - [x] Test complete workflow under various scenarios

## Dev Notes

### AI Integration Requirements
[Source: Epic 2 goals for AI content generation]

**Prompt Structure Needed:**
- Session context (title, description, goals)
- Audience targeting information
- Tone and style requirements
- Trainer background and expertise
- Location and practical details
- Content type specifications (promotional copy, social media, etc.)

**AI Service Considerations:**
- OpenAI GPT-4 or similar for high-quality content generation
- Prompt engineering for consistent, branded outputs
- Rate limiting and cost management
- Fallback handling for service unavailability
- Response parsing and validation

### Workflow Integration
[Source: Stories 2.1, 2.2 session worksheet flow]

**Integration Points:**
- Triggered after session draft is saved and complete
- Maintains session context throughout workflow
- Preserves generated prompts for future content regeneration
- Links to subsequent content generation step (Story 2.4)

**User Experience Flow:**
1. Complete session worksheet (Story 2.1)
2. Save as draft (Story 2.2)
3. **Generate and review AI prompt (this story)**
4. Proceed to content generation (Story 2.4)

### Success Criteria
The story is successful when Content Developers can generate high-quality, customizable AI prompts from their session data that will produce relevant promotional content.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-16 | 1.0 | Initial story creation for AI prompt generation and review | BMad Master |
| 2025-09-16 | 1.1 | Story implementation completed - AI prompt generation and review fully functional | James Dev Agent |

## Dev Agent Record

### Agent Model Used
James Dev Agent powered by Sonnet 4 (claude-sonnet-4-20250514)

### Completion Notes List
- **Enhanced existing AI prompt functionality** - Built upon the template system from Story 2.1
- **Created comprehensive backend AI service** - New AI module with prompt generation and template management
- **Integrated async AI prompt generation** - Frontend now calls backend API with fallback to local generation
- **Added robust error handling** - Network failures gracefully fall back to template-based generation
- **Enhanced UI with loading states** - Template loading and prompt generation have proper loading indicators
- **Comprehensive prompt editing** - PromptEditModal already existed with syntax highlighting and tips
- **Multiple template categories** - Marketing copy, trainer guides, and social media campaigns
- **Template variable validation** - Dynamic prompt building with all session attributes

### File List
- packages/backend/src/modules/ai/ai.module.ts (new AI service module)
- packages/backend/src/modules/ai/ai.service.ts (AI prompt generation service)
- packages/backend/src/modules/ai/ai.controller.ts (AI API endpoints)
- packages/backend/src/app.module.ts (updated to include AI module)
- packages/frontend/src/services/ai-prompt.service.ts (enhanced with backend integration)
- packages/frontend/src/components/sessions/AIPromptGenerator.tsx (enhanced with async loading)
- packages/frontend/src/components/sessions/PromptEditModal.tsx (existing comprehensive editor)
- packages/backend/src/modules/sessions/sessions.controller.ts (existing prompt storage endpoints)
- packages/backend/src/modules/sessions/sessions.service.ts (existing prompt management methods)

## QA Results
*To be populated by QA agent*