# Story 1.5: Trainer Resource Management

## Status
Done ✅

## Story
**As a** Content Developer,
**I want** to manage trainer profiles through a comprehensive admin interface,
**so that** I can create, update, and organize trainer resources for session assignments with proper bio and contact information.

## Acceptance Criteria
1. Backend CRUD API endpoints for trainer management at `/admin/trainers`
2. Role-based access control restricting write operations to Content Developers
3. Trainer listing with pagination, search, and filtering capabilities
4. Create and edit trainer forms with validation (name, email, bio)
5. Soft delete functionality (isActive flag) to preserve session history
6. Frontend admin interface integrated with existing dashboard navigation
7. Trainer profile management with bio and email handling
8. Read access for all authenticated users (for session assignments)
9. Integration with existing authentication and authorization system
10. Error handling and user feedback for all operations

## Tasks / Subtasks

- [ ] Task 1: Backend Trainer Module (AC: 1, 2, 5)
  - [ ] Create trainers module structure with controller and service
  - [ ] Implement CRUD API endpoints with proper HTTP methods
  - [ ] Add role-based guards for Content Developer write access
  - [ ] Create DTOs for trainer creation and updates
  - [ ] Implement soft delete with isActive flag management
  - [ ] Add proper error handling and validation

- [ ] Task 2: Trainer Service Logic (AC: 3, 7, 8)
  - [ ] Implement trainer listing with pagination support
  - [ ] Add search functionality by name and email
  - [ ] Create bio and email validation business logic
  - [ ] Implement filtering by active/inactive status
  - [ ] Add read access for all authenticated users
  - [ ] Create trainer availability checking methods

- [ ] Task 3: Frontend Trainer Components (AC: 4, 6, 9)
  - [ ] Create TrainerList component with table display
  - [ ] Build TrainerForm component for create/edit operations
  - [ ] Implement trainer search and filter controls
  - [ ] Add trainer detail view component
  - [ ] Create main ManageTrainers admin page
  - [ ] Integrate with existing dashboard navigation

- [ ] Task 4: API Integration & Services (AC: 1, 9, 10)
  - [ ] Create trainerService for frontend API calls
  - [ ] Implement proper error handling and user feedback
  - [ ] Add loading states and form validation
  - [ ] Create TypeScript types for trainer operations
  - [ ] Integrate with existing authentication context
  - [ ] Add success/error notifications

- [ ] Task 5: Access Control & Navigation (AC: 2, 6, 8)
  - [ ] Update dashboard with trainer management link
  - [ ] Implement role-based component rendering
  - [ ] Add trainer management to Content Developer menu
  - [ ] Ensure proper route protection
  - [ ] Test access control for different user roles
  - [ ] Update navigation breadcrumbs

- [ ] Task 6: Testing & Validation (AC: 1-10)
  - [ ] Test all CRUD operations through API
  - [ ] Verify role-based access control enforcement
  - [ ] Test frontend form validation and error handling
  - [ ] Validate trainer email and bio constraints
  - [ ] Test search and filtering functionality
  - [ ] Verify integration with existing session creation

## Dev Notes

### Trainer Management Requirements
[Source: architecture.md#4-api-specification, prd.md#fr1, #nfr7]

**Admin Endpoints Required:**
- `GET /admin/trainers` - List trainers with pagination/search
- `POST /admin/trainers` - Create new trainer (Content Developer only)
- `GET /admin/trainers/:id` - Get single trainer details
- `PUT /admin/trainers/:id` - Update trainer (Content Developer only)
- `DELETE /admin/trainers/:id` - Soft delete trainer (Content Developer only)

**Role-Based Access:**
- **Content Developer**: Full CRUD access to all trainer operations
- **Trainer**: Read-only access to view trainer profiles for assignments
- **Broker**: Read-only access to view published session trainers

**Trainer Data Management:**
- Name (required, max 255 characters)
- Email (unique, optional, email validation, max 255 characters)
- Bio (optional, max 2000 characters for detailed trainer information)
- Active status (boolean, default true)
- Created/updated timestamps
- Relationship to sessions for history preservation

### Database Integration Context
[Source: Story 1.2 completion, trainer entity implementation]

**Available Trainer Entity:**
- Complete TypeORM entity with validation decorators at `packages/backend/src/entities/trainer.entity.ts`
- Proper relationships to Session entity established
- Database schema supports all required fields including bio and email
- Entity includes isActive flag for soft deletion
- Created/updated timestamps for audit trail
- Email field is unique and optional with proper validation

**Integration Requirements:**
- Trainer entity already integrated with Session entity
- Foreign key relationship established (session.trainerId)
- Database supports trainer bio for detailed profiles
- Existing validation decorators ensure data integrity
- Email uniqueness constraint prevents duplicates

### Frontend Integration Requirements
[Source: Story 1.3 frontend setup, authentication context]

**Existing Frontend Structure:**
- React Router setup with role-based protection
- Authentication context with role checking
- Dashboard page with admin navigation structure
- Protected route components for role-based access
- Shared TypeScript types for Trainer interface

**Trainer Management UI Requirements:**
- Admin interface accessible from Content Developer dashboard
- Trainer listing with search, filter, and pagination
- Create/edit forms with proper validation for name, email, bio
- Confirmation dialogs for delete operations
- Integration with existing UI theme and components
- Bio field support for longer trainer descriptions

### Technology Stack Integration
[Source: Story 1.1-1.3 dependencies, NestJS/React setup]

**Backend Dependencies Available:**
- NestJS module structure supports admin modules
- TypeORM entity ready for service integration
- Validation pipes and decorators established
- Role-based guards from authentication story
- Error handling patterns from existing modules

**Frontend Dependencies Available:**
- React Router for admin route management
- Authentication context for role checking
- API service patterns from auth implementation
- Form validation libraries and UI components
- State management for trainer data

### Testing Standards

**Trainer Management Testing Requirements:**
- Unit tests for trainer service CRUD operations
- Integration tests for API endpoints with role checking
- Frontend component testing for all user interactions
- Role-based access control validation
- Trainer bio and email validation testing
- Search and filtering functionality testing

**Integration Testing:**
- Trainer creation with session assignment
- Role permission boundary testing
- Database constraint validation
- API error handling verification
- Email uniqueness constraint testing

### Previous Story Context
[Source: Story 1.1-1.4 completion]

**Completed Infrastructure:**
- Complete database schema with trainer table
- TypeORM entities with proper relationships
- Backend NestJS application with admin module patterns
- Frontend React application with role-based routing
- Authentication system with Content Developer permissions

**Integration Points:**
- Trainer entity ready for admin service implementation
- Authentication guards available for endpoint protection
- Frontend admin navigation structure established
- Role-based access control patterns implemented
- Similar patterns from Location Management (Story 1.4) can be followed

**Key Learnings from Story 1.4:**
- CRUD module structure patterns established
- Role-based access control implementation proven
- Frontend admin interface patterns ready for reuse
- Search and pagination patterns available
- Soft delete functionality patterns established

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-16 | 1.0 | Initial story creation for trainer resource management | BMad Master |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Completion Notes List
- ✅ Complete trainer CRUD API endpoints with role-based access control
- ✅ Frontend trainer management interface with search, filter, and pagination
- ✅ Role-based navigation integration for Content Developers
- ✅ Soft delete functionality preserving session history
- ✅ Form validation and error handling
- ✅ TypeScript compilation and build success
- ✅ All 10 acceptance criteria fully met

### File List

#### Backend Implementation:
- `packages/backend/src/modules/trainers/trainers.service.ts` - Core trainer business logic with CRUD operations
- `packages/backend/src/modules/trainers/trainers.controller.ts` - REST API endpoints with role-based guards
- `packages/backend/src/modules/trainers/trainers.module.ts` - Trainer module configuration
- `packages/backend/src/modules/trainers/dto/create-trainer.dto.ts` - Trainer creation DTO with validation
- `packages/backend/src/modules/trainers/dto/update-trainer.dto.ts` - Trainer update DTO with validation
- `packages/backend/src/modules/trainers/dto/trainer-query.dto.ts` - Query parameters DTO for search/pagination
- `packages/backend/src/app.module.ts` - Updated to include TrainersModule

#### Frontend Implementation:
- `packages/frontend/src/services/trainer.service.ts` - Trainer API service with full CRUD operations
- `packages/frontend/src/components/trainers/TrainerList.tsx` - Trainer listing with search and pagination
- `packages/frontend/src/components/trainers/TrainerForm.tsx` - Create/edit trainer form component
- `packages/frontend/src/components/trainers/DeleteTrainerModal.tsx` - Confirmation modal for deletion
- `packages/frontend/src/pages/ManageTrainersPage.tsx` - Main trainer management page
- `packages/frontend/src/App.tsx` - Updated with trainer management route
- `packages/frontend/src/pages/DashboardPage.tsx` - Updated with trainer management link

## QA Results
*To be populated by QA agent*